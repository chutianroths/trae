 # CONSENSUS_CT_AI应用

 ## 明确需求概述
 - **应用目标**: 构建跨平台的智能图像链式编辑应用，支持用户通过拖拽式流程完成复杂图像处理，兼顾移动与桌面体验。
 - **MVP 范围**:
   - 图像上传与本地压缩
   - 基础编辑模块全量上线（线稿上色、人物消除、自动打光、背景替换、风格转换、画质增强、老照片修复）
   - 链式编辑器基础框架（步骤编排、参数配置、执行流程、状态指示灯、实时预览）
   - 多模型 API 集成与统一网关（主模型 `gemini-2.5-flash-image`，预留扩展）
   - 用户认证系统（从零实现）
   - 状态管理、链式执行异常处理
 - **后续阶段（需预留扩展点）**: VPN 代理管理配置窗口、内部模块市场、内部提示词市场、高级编辑模块、人像美化等高级功能、网络诊断工具。

 ## 验收标准
 1. **功能性**: 所有基础编辑模块可在链式编辑器中插入、配置、执行，执行结果可预览与导出。
 2. **流程完整**: 链式编辑流程支持步骤管理、状态反馈（pending/processing/success/error）、错误处理、重试。
 3. **多模型适配**: 统一网关可调用 `gemini-2.5-flash-image`，具备模型选择扩展点和配置管理。
 4. **VPN 配置**: 提供代理设置入口，可输入代理地址/IP 并应用到需要代理的模型调用。
 5. **性能约束**: 冷启动 ≤3s、单步骤平均处理 ≤10s、内存 ≤200MB、模块加载 ≤2s（以真实设备/模拟器测试）。
 6. **安全要求**: 用户数据加密存储、API Key 使用 `.env` 管理、HTTPS 请求、本地图片默认不上传第三方未经授权的服务。
 7. **文档与测试**: 函数级注释齐全，单元/集成测试覆盖核心流程，更新设计与操作文档。

 ## 技术实现策略
 - **前端客户端**: React Native + TypeScript，结合 Zustand 状态管理与 React Native Paper UI；使用 Expo 加速开发。
 - **后端服务**: 基于 Next.js 14 API 路由，为链式编辑任务、模型请求、用户管理提供 RESTful/GraphQL（视需求）接口。
 - **数据层**: MongoDB 存储用户数据、链式任务、模块配置、提示词模板；必要时使用 Redis 缓存处理状态。
 - **模型网关**: 统一封装各模型 API，默认接入 `gemini-2.5-flash-image`，设计扩展接口适配更多模型；支持模型能力描述、费用与延迟指标。
 - **VPN 配置**: 提供设置界面 + 本地存储配置，调用时根据模型属性决定是否使用代理；抽象 `ProxyRouter` 统一处理。
 - **图片处理**: 使用本地压缩库（如 react-native-image-processor 或自研模块）处理上传图片，前端控制质量与尺寸；可选原生模块增强性能。
 - **认证系统**: 从零实现注册、登录、Token 管理（JWT 或 Session），角色权限与提示词访问控制同步设计。
 - **模块/提示词市场**: 首期以内置数据与内部管理为主，后端提供增删改查接口，预留未来对接外部市场。

 ## 任务边界与限制
 - 现阶段不实现第三方模块市场对接、外部提示词市场或高级编辑模块（如特效合成、人像美化等）上线，但需在架构上确保可扩展。
 - VPN 服务由用户提供参数，不负责搭建代理基础设施。
 - 多模型 API 需可扩展，但 MVP 只需保证主模型调用稳定；其他模型可 stub/占位。
 - 图片仅本地压缩与处理，未经用户许可不上传到云端。

 ## 不确定性与解决状态
 - MVP 范围、模型供应商、VPN 配置方式、压缩策略、市场版本、认证方案已确认。
 - 外部依赖（如模型 API 具体规范、VPN 现有服务）的接口细节需结合供应商文档在设计阶段补充。

 ## 下一步行动
 1. 依据共识编写 `DESIGN_CT_AI应用.md`，完成系统分层与模块设计、接口定义、数据流图。
 2. 在设计文档中细化模型网关、链式引擎、状态管理、认证模块的协同关系。
 3. 按 6A 工作流进入 Architect 阶段。


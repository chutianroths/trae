 # ALIGNMENT_CT_AI应用

 ## 项目上下文分析
 - **项目类型**: 跨平台智能图像编辑应用，集成多AI模型与链式编辑流程，覆盖移动端与桌面端。
 - **核心技术栈**: 前端 React Native + TypeScript，状态管理使用 Zustand，UI 采用 React Native Paper；后端基于 Next.js 14（Node.js 18+）与 MongoDB 6.0+；开发工具包括 Expo、Cursor、Mermaid。
 - **系统分层**: 包含 UI 层（上传界面、链式编辑器、模块管理器、状态指示灯、设置面板）、业务逻辑层（链式编辑引擎、模块加载器、状态管理器、图片压缩器、代理路由器、提示词管理器）、API 适配层（统一接口网关、模型路由器、错误处理器、请求队列）、数据持久层（用户配置、模块缓存、编辑历史、提示词库）、AI 模型层（Gemini、ChatGPT、文心一言、通义千问等）与外部服务层（模块市场、VPN 代理服务、图片 CDN、用户认证）。
 - **核心业务流程**: 用户上传图片 → 通过链式编辑器编排步骤 → 配置参数 → 依次调用 AI 模块处理 → 状态指示灯反馈 → 支持条件分支与错误处理 → 结果导出。
 - **关键子系统**: 链式编辑系统、多模型 API 管理、VPN 代理管理、图片压缩优化、提示词分级管理、模块化扩展体系。

 ## 原始需求要点
 - 实现基础与高级图像编辑模块（线稿上色、人物消除、自动打光、背景替换、风格转换、画质增强、老照片修复、人像美化、创意生成、特效合成）。
 - 构建可视化链式编辑器，具备步骤管理、实时预览、条件分支、状态指示灯等功能。
 - 设计多模型 API 管理系统，支持模型推荐、负载均衡、故障转移、成本优化。
 - 实现 VPN 代理管理、图片压缩优化、分级提示词管理与模块化扩展能力。
 - 提供跨平台 UI 与一致的用户体验，满足性能、兼容性与安全要求。
 - 按阶段交付：MVP（核心功能）、功能完善、平台发布，并满足产品与技术 KPI。

 ## 需求理解
 - **功能范围**: 以链式编辑为核心的图像处理流程，结合多模型协作、提示词管理、模块市场等扩展能力。
 - **数据模型**: `EditModule`、`ModelConfig`、`VPNConfig`、`CompressionConfig`、`PromptTemplate`、`EditStep`、`AIRequest`、`EditProject` 等接口定义提供数据结构参考。
 - **状态反馈**: 通过状态指示灯（pending / processing / success / error）与进度、消息等信息为步骤执行提供实时反馈。
 - **性能与体验**: 关注启动时间、处理耗时、内存、模块加载速度，提供多端兼容与键盘快捷键支持。
 - **安全合规**: 实现数据加密、隐私保护、权限控制、HTTPS 通信，API Key 需保存在 `.env`。

 ## 边界与约束确认
 - **必须遵循的功能**: 在不改变需求文档列出的应用功能前提下实现或规划系统，可接受在实现方式上的优化。
 - **技术约束**: 需与指定技术栈与架构保持一致；强调测试优先、函数级注释、文档同步更新。
 - **平台范围**: 支持 iOS/Android/Windows/macOS，同一代码基座需考虑不同终端的交互差异。
 - **阶段目标**: 初期重点实现 MVP 功能集，逐步扩展高级能力与发布流程。

 ## 风险与不确定性
 - 多模型 API 的具体供应商接口、鉴权方式与费用策略未明确。
 - VPN 代理管理、网络检测、离线模式的实现细节与可行性依赖外部服务支持，需要进一步确认。
 - 模块市场、模块 SDK、自动热更新等生态相关机制的实现范围需定义优先级。
 - 提示词市场的内容监管和权限策略尚需细化。

## 待澄清问题
1. ✅ 已确认：MVP 阶段需要全部基础编辑模块上线。
2. ✅ 已确认：多模型 API 以主流供应商（以 `gemini-2.5-flash-image` 为主），需构建适配多模型的统一网关。
3. ✅ 已确认：已有 VPN/代理管理服务，需提供输入代理地址/IP 的配置窗口。
4. ✅ 已确认：图片压缩策略为本地压缩。
5. ✅ 已确认：模块市场与提示词市场阶段性先实现内部版本。
6. ✅ 已确认：用户认证系统需要从零搭建。

 ## 下一步建议
 - 获取上述问题的明确答案，以便制定可执行的设计方案。
 - 基于确认结果完善共识文档（CONSENSUS），进入架构设计阶段。


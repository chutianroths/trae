 # TASK_CT_AI应用

 ## 任务概览

 ### 任务依赖图
 ```mermaid
 graph TD
     A[需求回顾与环境准备] --> B[后端基础设施搭建]
     A --> C[前端基础框架搭建]
     B --> D[认证与权限服务实现]
     B --> E[模块管理服务实现]
     B --> F[提示词管理服务实现]
     B --> G[链式执行服务与模型网关]
     D --> H[前端认证流程对接]
     C --> I[图像上传与本地压缩模块]
     C --> J[链式编辑器 UI 与状态管理]
     C --> K[模块库与提示词界面]
     G --> L[前端链式执行引擎与状态指示]
     I --> L
     J --> L
     E --> K
     F --> K
     G --> M[VPN/代理配置功能]
     L --> N[集成测试与验收验证]
     K --> N
     M --> N
 ```

 ---

 ## 任务详情

 ### 任务 A: 需求回顾与环境准备
 - **输入契约**: 已确认的需求文档、共识文档、设计文档；开发环境访问权限。
 - **输出契约**: 搭建好开发环境、工具链配置（Node.js、Expo、Next.js、MongoDB、本地代理测试工具）；整理团队规范清单。
 - **实现约束**: 遵循 Windows 平台、PowerShell；工具版本与设计一致；记录环境差异。
 - **依赖关系**: 无（起点任务）；完成后才能启动前后端建设。

 ### 任务 B: 后端基础设施搭建
 - **输入契约**: 任务 A 完成；Next.js 项目初始化需求。
 - **输出契约**: 初始化 Next.js 14 项目结构、配置 TypeScript、ESLint、Prettier、环境变量管理；连接 MongoDB。
 - **实现约束**: 使用 `.env` 管理敏感信息；提供基础健康检查 API。
 - **依赖关系**: 完成后支撑后续服务实现（任务 D/E/F/G）。

 ### 任务 C: 前端基础框架搭建
 - **输入契约**: 任务 A 完成；React Native/Expo 项目模板需求。
 - **输出契约**: 初始化 Expo + React Native + TypeScript 项目，整合 Zustand、React Native Paper、导航框架；设置全局主题与国际化结构。
 - **实现约束**: 目录划分符合架构（components/screens/services/stores）；启用代码分割、深色模式预留。
 - **依赖关系**: 后续 UI/功能实现依赖（任务 H/I/J/K/L/M）。

 ### 任务 D: 认证与权限服务实现
 - **输入契约**: 任务 B 完成；设计文档中的认证模型。
 - **输出契约**: 实现注册、登录、Token 发行、刷新、角色管理 API；MongoDB 用户集合 schema；密码加密与验证。
 - **实现约束**: 使用 JWT + Refresh Token；密码使用 bcrypt；提供单元测试。
 - **依赖关系**: 任务 H（前端认证）依赖；任务 G 需要用户上下文。

 ### 任务 E: 模块管理服务实现
 - **输入契约**: 任务 B 完成；模块数据模型定义。
 - **输出契约**: `ModuleService` API（列表、详情、安装状态更新）、内部模块市场数据接口；MongoDB 模块集合。
 - **实现约束**: 仅内部模块；提供分页、按分类过滤；记录版本信息。
 - **依赖关系**: 任务 K（前端模块界面）、任务 G（链式执行需要模块元数据）。

 ### 任务 F: 提示词管理服务实现
 - **输入契约**: 任务 B 完成；提示词模型定义。
 - **输出契约**: 提示词 CRUD、收藏、使用统计 API；角色权限检查；MongoDB 提示词集合。
 - **实现约束**: 仅内部提示词市场；提供成功率、使用次数字段；编写测试覆盖。
 - **依赖关系**: 任务 K（提示词界面）。

 ### 任务 G: 链式执行服务与模型网关
 - **输入契约**: 任务 B 与 D 完成；模块/提示词元数据。
 - **输出契约**: 链式执行 API（创建执行、查询状态、终止执行）、`ModelRouter` 适配器、`ProxyRouter` 配置应用、请求队列、错误中心。
 - **实现约束**: 默认集成 `gemini-2.5-flash-image`，预留扩展接口；执行日志记录；实现重试策略。
 - **依赖关系**: 任务 L（前端执行引擎）、任务 M（代理配置）、任务 N（集成测试）。

 ### 任务 H: 前端认证流程对接
 - **输入契约**: 任务 C 与 D 完成；后端认证 API 可用。
 - **输出契约**: 注册、登录、忘记密码、权限守卫、Token 刷新逻辑；安全存储 token；认证状态 UI。
 - **实现约束**: 使用 Zustand 存储用户信息；利用 SecureStore/Keychain；提供输入验证与错误提示。
 - **依赖关系**: 为任务 L/K/M 提供用户上下文。

 ### 任务 I: 图像上传与本地压缩模块
 - **输入契约**: 任务 C 完成；设备权限管理。
 - **输出契约**: 图片上传组件、裁剪/预览、本地压缩策略实现（质量/尺寸配置）；批量处理支持。
 - **实现约束**: 采用专用库（如 `react-native-image-crop-picker`、`react-native-image-resizer`）；提供压缩前后对比。
 - **依赖关系**: 任务 L（执行前压缩），任务 N（性能测试）。

 ### 任务 J: 链式编辑器 UI 与状态管理
 - **输入契约**: 任务 C 完成；模块元数据接口可调用（可先使用 mock）。
 - **输出契约**: 链式编辑器界面（步骤列表、拖拽、参数配置、条件分支）；Zustand store 管理步骤、状态指示、操作历史。
 - **实现约束**: 支持桌面端拖拽、移动端交互；为条件分支提供表达式输入。
 - **依赖关系**: 任务 L（执行引擎整合）。

 ### 任务 K: 模块库与提示词界面
 - **输入契约**: 任务 C、E、F 完成（服务可用或提供 mock）。
 - **输出契约**: 模块列表、分类筛选、安装状态操作、模块详情；提示词列表、收藏、评分、统计展示。
 - **实现约束**: 同步用户权限；提供加载状态与错误处理；支持搜索。
 - **依赖关系**: 任务 N（整体验收）。

 ### 任务 L: 前端链式执行引擎与状态指示
 - **输入契约**: 任务 C、G、H、I、J 完成；后端执行 API 可用。
 - **输出契约**: 前端执行引擎封装（步骤调度、状态同步、错误重试、终止控制）、状态指示器联动、实时预览刷新。
 - **实现约束**: 支持 WebSocket 或轮询；处理网络异常；提供执行日志。
 - **依赖关系**: 任务 N（集成验证）。

 ### 任务 M: VPN/代理配置功能
 - **输入契约**: 任务 C 完成；任务 G 提供代理应用逻辑。
 - **输出契约**: 设置界面允许输入代理地址/IP、端口、凭证；本地存储配置；检测连接按钮。
 - **实现约束**: 对接 ProxyRouter；敏感信息加密存储；提供状态反馈。
 - **依赖关系**: 任务 N（验收）。

 ### 任务 N: 集成测试与验收验证
 - **输入契约**: 任务 D~M 主要功能完成；测试环境可用。
 - **输出契约**: 集成测试脚本、MVP 验收报告、性能测试结果、文档更新（ACCEPTANCE）。
 - **实现约束**: 覆盖核心流程（认证、上传、执行、模块/提示词操作、代理配置）；测试通过标准符合验收条款。
 - **依赖关系**: 所有核心任务完成后执行。

 ---

 ## 质量与交付要求
 - 所有任务需编写对应测试（单元/集成）。
 - 函数级注释必须包含功能描述、参数、返回值。
 - 更新对应文件夹下的设计/实现文档，记录配置、接口、测试结果。
 - 每个任务完成后更新 `docs/CT_AI应用/ACCEPTANCE_CT_AI应用.md`。

